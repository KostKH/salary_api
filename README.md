# salary_api

`salary_api` - REST-сервис просмотра сотрудниками текущей зарплаты и даты следующего
повышения.

## Быстрый старт
Для просмотра размера своей зарплаты, сотрудник должен отправить запрос на получения токена, используя известный ему username и пароль на endpoint `<host_address>:8000/v1/users/signin/`.
Далее, для получения данных по зарплате и даты следующего повышения, сотрудник должен отправить GET-запрос на ендпойнт `<host_address>:8000/v1/salary/me/`, добавив в заголовки запроса свой токен (указав, при этом, его тип - Bearer)

Более подробную информацию об ендпойнтах API можно посмотреть по ссылкам:

- `<host_address>:8000/docs/`
- `<host_address>:8000/redoc/`


## Системные требования
- Python 3.11+
- Works on Linux, Windows, macOS

## Технологии:
- Python 3.11
- FastAPI
- SQLite
- SQLAlcemy
- Alembic 
- Uvicorn
- Gunicorn
- Docker & Docker compose

## Как запустить проект:

Для запуска в проект вложена конфигурация docker-compose. После запуска docker-compose API будет доступно по адресу: `http://<host address>:8000/`

Необходимо выполнить следующие шаги:
- Склонируйте репозиторий и перейдите в папку проекта, где расположен файл manage.py:
```
git clone https://github.com/KostKH/salary_api.git
cd salary_api/infra/
```
- Проверьте, что свободен порт `8000`, необходимый для работы приложения

- Проверьте, что на машине / сервере установлены `docker` и `docker compose`

- Сгенерируйте свой секретный ключ для `FastAPI`. Это можно сделать, например, введя в терминале `bash` такую команду:
```
grep -ao '[a-zA-Z0-9]' < /dev/urandom | head -24 | tr -d '\n'
```
- Cоздайте в папке `infra` файл `.env` с переменными окружения. Можно создать его из вложенного образца `env_example.env`:
```
cp env_example.env .env
```
- Откройте файл .env в редакторе и поменяйте, при необходимости, переменные окружения. При этом обязательно поменяйте секретный ключ `JWT_SECRET_KEY` на значение, которое вы сгенерировали на предыдущем шаге:
```
DATABASE_URL='sqlite+aiosqlite:///salary_db/salary.db'
JWT_SECRET_KEY=some_secret_key
JWT_ALGORITHM=HS256
JWT_EFFECT_SECONDS=86400

```
- Установите и запустите приложение в контейнере. (Возможно, вам придется добавить `sudo` перед текстом команды в этом и следующем шагах):
```
docker-compose up -d
```
- Запустите миграции:
```
docker-compose exec salari.api alembic upgrade head
```

## Использование API
Ниже приведены доступные эндпойнты. В описания эндпойнтов в скобках приведены доступные методы

#### Эндпойнты, доступные всем пользователям:
```
/docs/ - документация в формате OpenAI (GET)
/redoc/ - документация в формате redoc (GET)
/v1/user/signin/ - регистрация: получение токена пользователя (POST)
```
#### Эндпойнты, доступные авторизованным работникам:
```
/v1/salary/me/  - просмотр работником данных о своей зарплате и дате следующего повышения (GET)
```
#### Эндпойнты, доступные только суперпользователю:
```
/v1/user/ - просмотр (GET), создание (POST) пользователей
/v1/salary/ - просмотр (GET), внесение в базу (POST) записей о зарплате и дате следующего повышения
```
## О программе:

Автор: Константин Харьков